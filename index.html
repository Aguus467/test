<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reproductor FoxSports3</title>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body { margin: 0; background: black; display: flex; justify-content: center; align-items: center; height: 100vh; }
    video { width: 80%; height: auto; }
  </style>
</head>
<body>
  <video id="videoPlayer" controls></video>

  <script>
    // URL del stream
    const mpdUrl = "https://csc-axs-edge01.sensa.com.ar/live/eds/FoxSports3/live_dash_cld/FoxSports3.mpd";

    // Llave ofuscada del script original
    const obfuscatedKey = "======QO0EmZ4QDOiNDN2MjM0EmZ5MDMhVTNwYTMiVjY2QDMhFTZhJTNkJ2YwUzM5ADMwATOwIWMiZTZ1EzY4UGZ2UzMjVTY4Y2YlZ2M4EWYklTZxAjN3UWMiVWOlhjM0UWOjRWMwETNjdzNmRjMyM2YwczMhhTYkJmM3MGZzMWO4kTN2EzN4EmY5ATMiZTOmZWN3gzY0EDOiNWM1cTYiNGOmFjM6MzYhF2NwEjN5Q2Y5QTYlNGN1cDNiNzN3MDNhRGN5MzNa1b2c3d4e5f67890";

    // Funci√≥n para desencriptar la llave (igual al script original)
    function decryptAES(ciphertext, ivHex, key) {
      const keyHash = CryptoJS.SHA256(CryptoJS.enc.Utf8.parse(key));
      const iv = CryptoJS.enc.Hex.parse(ivHex);
      const decrypted = CryptoJS.AES.decrypt(
        { ciphertext: CryptoJS.enc.Hex.parse(ciphertext) },
        keyHash,
        { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
      );
      return decrypted.toString(CryptoJS.enc.Utf8);
    }

    function deobfuscateKey(obfKey) {
      const trimmed = obfKey.slice(4, -16);
      const reversed = trimmed.split("").reverse().join("");
      const decoded = CryptoJS.enc.Base64.parse(reversed).toString(CryptoJS.enc.Utf8);
      const [ivHex, ciphertext] = decoded.split(':');
      const masterKey = "EnRjmF8X6VZlfS4PifbJD8oWK4PaHnlZ";
      return decryptAES(ciphertext, ivHex, masterKey);
    }

    const decryptedKey = deobfuscateKey(obfuscatedKey);
    const [kid, key] = decryptedKey.split(':');

    // Configurar dash.js
    const video = document.getElementById("videoPlayer");
    const player = dashjs.MediaPlayer().create();
    player.initialize(video, mpdUrl, true);

    // Agregar clave de DRM (ClearKey)
    player.setProtectionData({
      "org.w3.clearkey": {
        "clearkeys": { [kid]: key }
      }
    });
  </script>
</body>
</html>
