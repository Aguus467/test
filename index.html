<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Ao</title>
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <h1>A</h1>
    
    <select id="streamSelect">
        <option value="clarosports">ClaroSports</option>
        <option value="telefe">Telefe</option>
        <option value="tycsports">TyC Sports</option>
        <!-- Agregá más opciones según tu objeto streams -->
    </select>

    <button onclick="loadStream()">Reproducir</button>

    <video id="videoPlayer" controls autoplay width="800" height="450"></video>

    <script>
        // Copiamos aquí tu objeto streams y funciones decryptAES / deobfuscateKey / getStreamById
        let mt = "csc-axs-edge01.sensa.com.ar";
        const streams = {
            clarosports: {
                url: "https://"+mt+"/live/eds/ClaroSports/live_dash_cld/ClaroSports.mpd",
                key: "======wMklzY3IDZlJDZkRTMilDO4EWO3M2YwYzY4MmYkBzM0MTOldjNjVDMxcTNlBDZiRmNmFjN3MGOkBzMyQmMlFTYhFzMkNzY2Q2YilDNiVTZmJWZyUGM5ITM2MjZ0IGOykzYygjN4QjZ1gTZ3IGNwQTZxMzMlN2M3ITN4ETMkdjMxcTYkJmYmJ2YhJjY0gTYhlDNwgDZhBTZihDOkNDOxEDZ6ITNzYzY4UGOmljY1kDZ4YWYwIWY0YDZjV2N5MTYhVjNa1b2c3d4e5f67890"
            },
            telefe: {
                url: "https://"+mt+"/live/eds/Telefe/live_dash_cld/Telefe.mpd",
                key: "======QYxQmMxYDZmRGOjFDZ2QWNjhTO4kTM1IWY1QWZjZjZkhDN5ImNxIGNmNWYzIWOhlTYyUDMxIWO0UzY4MzYzIjYyUTY0QmZ0UGZwgzMxYGZiJjY5MmZzkTNxUGOxETNlhTY3QTZ5QGZ1gjZ2UmMkZmM5EWZ4MWY2QzNhZGMwczM3YmN1QWY3gzNxEWZ5UWYilDMzgDZmVTO1EDZxEDZkVmY6I2YxYTNyU2YwcjN4M2MyYjMwYDNjdTZyIWM2kjYzgjYa1b2c3d4e5f67890"
            },
            tycsports: {
                url: "https://"+mt+"/live/eds/TYCSports/live_dash_cld/TYCSports.mpd",
                key: "======wYyYjNiZWN4YDNwYDZmJjY4EjNlBDNjhTN3kjNlVmYmJzM1UzNxQTN5ATN1QGZlZmM1EDZjF2YjNjZmZDZkBTNiFGMjRmZjZDOhJjNwkTN1QmYiZWNlZmN4gjMiNmNyMDM0gzYyMTMxQjNlNzYyYDNxkTZiFWZkRmNiNGOiBzNhdjYmhzM5UDOzYjNhVzYjZDMkZzM2EzYwUmY0QjNyETY6MDNhRWNhZmNjRWO3UTOjhDZ4QWOjhTZxIGMhJGZhZmNa1b2c3d4e5f67890"
            }
        };

        // Funciones decryptAES, deobfuscateKey y getStreamById van aquí (copiadas tal cual de tu script anterior)
        function decryptAES(ciphertext, ivHex, key) {
            const keyHash = CryptoJS.SHA256(CryptoJS.enc.Utf8.parse(key));
            const iv = CryptoJS.enc.Hex.parse(ivHex);
            const decrypted = CryptoJS.AES.decrypt(
                { ciphertext: CryptoJS.enc.Hex.parse(ciphertext) },
                keyHash,
                { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
            );
            return decrypted.toString(CryptoJS.enc.Utf8);
        }

        function deobfuscateKey(obfuscatedKey) {
            const trimmedKey = obfuscatedKey.slice(4, -16);
            const reversedKey = trimmedKey.split("").reverse().join("");
            const decodedBytes = CryptoJS.enc.Base64.parse(reversedKey);
            const decodedText = decodedBytes.toString(CryptoJS.enc.Utf8);
            const [ivHex, ciphertext] = decodedText.split(':');
            const masterKey = "EnRjmF8X6VZlfS4PifbJD8oWK4PaHnlZ";
            return decryptAES(ciphertext, ivHex, masterKey);
        }

        function getStreamById(streamId) {
            const stream = streams[streamId];
            let finalKey = stream.key;
            if (finalKey.startsWith('====')) {
                finalKey = deobfuscateKey(finalKey);
            }
            const [kid, key] = finalKey.split(':');
            return {
                url: stream.url,
                key: { [kid.trim()]: key.trim() }
            };
        }

        function loadStream() {
            const select = document.getElementById('streamSelect');
            const selectedId = select.value;
            const streamData = getStreamById(selectedId);
            const video = document.getElementById('videoPlayer');

            // Inicializar dash.js
            const player = dashjs.MediaPlayer().create();
            player.initialize(video, streamData.url, true);

            // Configurar DRM con la key
            player.setProtectionData({
                "com.widevine.alpha": {
                    "serverURL": "", // Si tenés un license server, poner URL aquí
                    "httpRequestHeaders": {
                        "Authorization": "Bearer " + Object.values(streamData.key)[0]
                    }
                }
            });

            console.log("Reproduciendo stream:", selectedId, streamData);
        }
    </script>
</body>
</html>
